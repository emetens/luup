local ICONS = {
  ICON_LIST = {
    -- TODO have proper icons for the fans
    ["SenseMe.png"] = "89504E470D0A1A0A0000000D494844520000003C0000003C08030000000D222940000000017352474200AECE1CE90000000467414D410000B18F0BFC610500000300504C544500000003AFEC00AFED02B0ED05B0ED07B1EE08B1EE0AB2ED08B2EE0CB3EE0FB4EE12B4EE14B5EE15B5EF15B6EE16B6EF18B6EF1BB8EF1DB8EF20B9EF22BAEF24BAF029BCF02DBDF02FBEF030BEF032BFF136C0F139C1F13DC2F141C3F242C4F245C4F249C6F24CC7F24EC8F350C8F355C8F154C9F356CAF358CBF35ECCF460CDF461CEF466CFF468CFF468D0F46AD0F56CD1F56ED2F571D2F575D4F578D4F57DD6F680D7F682D8F684D8F687D9F787DAF788DAF689DAF78CDBF78EDCF790DCF795DEF796DEF899DFF89BE0F89DE0F8A0E1F8A4E2F8A5E3F9A8E4F9ADE5F9B2E7FAB4E7FAB6E8FAB8E9FABBEAFABCEAFAC1ECFBC5ECFBC9EEFBCFF0FCD2F1FCD6F2FCD9F3FCDBF4FCDDF4FDE0F5FDE2F6FDE5F6FDE8F8FDEBF9FEECF9FEEEFAFEF0FAFDF1FAFEF5FCFEFBFDFEF9FDFFFBFEFFFEFEFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000DD3167310000010074524E53FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF0053F70725000000097048597300000EC300000EC301C76FA8640000001A74455874536F667477617265005061696E742E4E45542076332E352E313030F472A1000002C749444154484BED95EF5BD33010C7350DB36528251D0366276D41713011A71B5307084EF9A9D0B221D2D9D90AF7FFFF0778494B5B51D833F47978E1BE2F92CB359FBB24BDB477CEFF42B70B931B6900F7A901DCA706709FFA9770C602545D8E863DF42B6C0230EC60251CF6521ACEAC414E180C44D7532958D9818CF011BD6F986E8114FAC6211F1ABD94C055A0A1EB2EA8A17185A269A8189EEA84FBEDA9EAD3C84860091A91E72A417810F33BBF677E787A7D6209F88928C37A3B371C1D4D0237AE3CE0AC6845BA7B0001D6D0A8F0A02E60D8881C9735D9E6E5460D105557C31C71E218EE54238710AD60829AB0A088ADF609C7D88FBBEAE82A9A267F94C0DFD2F0086E30EB1968317887907A08446C195E4F61901937DC4AB2ECCD708C92C0D9265968532263902648B3F083E7A500DF55C7219C276C01835DC02BDD8BCA28C0387C28C1ECF124C01430175749DB1B2C8F77A6D97C70BA588175283C9B293E9E8961F5ABA82BFA082C891850E0594708AD01E8E8661841258A6F9045EC310E252A2BC630619B38816711E9FF28BDAB4456A418C6E3D0D8F51F01D5B9F43C05F7AF04A6B9B93C46CEF075537EB1A94C65AE21D1F1D25034159F0E89AA19C22686474AEF1BEB65261FF377B6758474DD5BF7B80EF778FBC5529A3EC0D113D2F2E609F9DC4EC3A5B7F3DA6CA3A27477D1BBE761F45530E72AB03D67D92DCB2A07FB5BF086151CD05D0874E27452307D51C5852D96D534CCF0AD2C1362B74C73C1AFF95D5CB3096BEEB17B3276097E85F0CB1A4BE0B518F66DBBE51B818B33386CEB81DD4AC364B96ADD2FD66B4AF7606262E2E3D9B43C6AFB7204DB788EEECA363CCF6A0750741D5202E828A612C34A63A3BEBA94973D5E29A543F002BF441298ECEE3FD885E0CC2B93131C36C0654B2C8649C6589AC46BAEE550B29437745E4E348717688CFF08144D22DAB48EDBD1C6F0F2E434FC4A24F00D3480FBD47F0CDF58B7059F9FFF046A843AFFD91AA9DD0000000049454E44AE426082",
  },
  file_exists = function(self, filename)
    local file = io.open(filename)
    if (file) then
      io.close(file)
      return true
    else
      return false
    end
  end,
  decode_hex_string = function(self, hexStr)
    if (not hexStr) then
      luup.log("(" .. PLUGIN.NAME .. "::ICONS::decode_hex_string) No hex data supplied.", 1)
      return nil
    end
    if (math.floor(#hexStr / 2) ~= (#hexStr / 2)) then
      luup.log("(" .. PLUGIN.NAME .. "::ICONS::decode_hex_string) Invalid hex data supplied.", 1)
      return nil
    end
    debug("(" .. PLUGIN.NAME .. "::ICONS::decode_hex_string) input size [" .. (#hexStr or "NIL") .. "].", 2)
    local i = 1
    local hexStr_len = hexStr:len()
    local VALUE = ""
    while i <= hexStr_len do
      local c = hexStr:sub(i, i + 1)
      VALUE = VALUE .. string.char(tonumber(c, 16))
      i = i + 2
    end
    debug("(" .. PLUGIN.NAME .. "::ICONS::decode_hex_string) output size [" .. (#VALUE or "NIL") .. "].", 2)
    return VALUE
  end,
  create_png = function(self, filename, data)
    -- data = hex encoded png file contents
    local png_data = self:decode_hex_string(data)
    if (png_data and (#png_data == (#data / 2))) then
      debug("(" .. PLUGIN.NAME .. "::ICONS::create_png): writing PNG Data for file [" .. (filename or "NIL") .. "]", 2)
      local file = io.open(filename, "wb")
      if (file) then
        file:write(png_data)
        file:close()
        return true
      else
        return false
      end
    else
      luup.log("(" .. PLUGIN.NAME .. "::ICONS::create_png): PNG Data DECODE ERROR", 1)
      return false
    end
  end,
  CreateIcons = function(self)
    local fPath = "/www/cmh/skins/default/icons/" -- UI5 icon file location
    if (PLUGIN.MIOS_VERSION == "UI7") then
      fPath = "/www/cmh/skins/default/img/devices/device_states/" -- UI7 icon file location
    end
    if (PLUGIN.OPENLUUP and PLUGIN.OPENLUUP_ICONFIX) then
      -- make sure the icons directory exists
      os.execute("mkdir /etc/cmh-ludl/icons")
      fPath = "/etc/cmh-ludl/icons/"
    end
    for fName, fData in pairs(self.ICON_LIST) do
      if (not self:file_exists(fPath .. fName)) then
        self:create_png(fPath .. fName, fData)
      end
    end
  end
}
